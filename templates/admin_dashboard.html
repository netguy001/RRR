<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>RRR Construction Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
</head>

<body>
  <header>
    <div class="logo">
      <span class="logo-icon">RRR</span>
      <span>Construction Admin Panel</span>
    </div>
    <div class="user">Welcome, <strong>{{ admin }}</strong> | <a href="{{ url_for('admin_logout') }}">Logout</a></div>
  </header>

  <div class="dashboard-container">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h3>Menu</h3>
      </div>
      <ul class="sidebar-nav">
        <li><a href="#dashboard" class="nav-link" data-target="dashboard-section"><i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span></a></li>
        <li><a href="#projects" class="nav-link" data-target="projects-section"><i class="fas fa-building"></i>
            <span>Projects</span></a></li>
        <li><a href="#testimonials" class="nav-link" data-target="testimonials-section"><i
              class="fas fa-quote-left"></i> <span>Testimonials</span></a></li>
        <li><a href="#messages" class="nav-link" data-target="messages-section"><i class="fas fa-envelope"></i>
            <span>Customer Queries</span></a></li>
      </ul>
    </nav>

    <main class="main-content">
      <div id="dashboard-section" class="content-section">
        <div class="section">
          <div class="section-header">
            <h2><i class="fas fa-tachometer-alt" style="margin-right: 0.5rem; color: var(--primary-yellow);"></i>
              Dashboard Overview</h2>
          </div>
          <p style="font-size: 1.1rem; color: #555;">Welcome to the RRR Construction Admin Panel. Use the menu on the
            left to manage your website's content.</p>
        </div>
      </div>

      <div id="projects-section" class="content-section">
        <div class="section">
          <div class="section-header">
            <h2><i class="fas fa-building" style="margin-right: 0.5rem; color: var(--primary-yellow);"></i>Manage
              Projects</h2>
            <button class="btn btn-primary" onclick="openProjectModal()">
              <i class="fas fa-plus"></i> Add New Project
            </button>
          </div>
          <div class="grid-container" id="projectsList">
            {% for p in projects %}
            <div class="card" data-id="{{p.id}}">
              <img class="card-img"
                src="{{ url_for('uploaded_file', filename=p.image) if p.image else 'https://placehold.co/400x200/0D3B66/FFFFFF?text=No+Image' }}"
                alt="{{ p.title }}">
              <div class="card-title">{{ p.title }}</div>
              <div class="card-details">{{ p.description }}</div>
              <div class="card-details"><strong>Category:</strong> {{ p.category|capitalize }} |
                <strong>Status:</strong> {{
                p.status|capitalize }}
              </div>
              <small class="card-details"><i class="fas fa-calendar"></i> Created: {{ p.date_created }}</small>
              <div class="card-actions">
                <button class="btn btn-primary" onclick="editProject('{{p.id}}')">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" onclick="confirmDelete('project', '{{p.id}}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
            {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
              <i class="fas fa-building" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
              <p>No projects have been added yet.</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div id="testimonials-section" class="content-section">
        <div class="section">
          <div class="section-header">
            <h2><i class="fas fa-quote-left" style="margin-right: 0.5rem; color: var(--primary-yellow);"></i>Manage
              Testimonials</h2>
            <button class="btn btn-primary" onclick="openTestimonialModal()">
              <i class="fas fa-plus"></i> Add New Testimonial
            </button>
          </div>
          <div class="grid-container" id="testimonialsList">
            {% for t in testimonials %}
            <div class="card" data-id="{{t.id}}">
              <div style="display: flex; align-items: center; gap: 1.2rem; margin-bottom: 1.5rem;">
                <img class="card-author-img"
                  src="{{ url_for('uploaded_file', filename=t.image) if t.image else 'https://placehold.co/70x70/EFEFEF/333333?text=?' }}"
                  alt="{{ t.name }}">
                <div>
                  <div class="card-title" style="margin-bottom: 0.2rem;">{{ t.name }}</div>
                  <div class="card-details">{{ t.company }}</div>
                </div>
              </div>
              <div class="rating-stars" data-rating="{{ t.rating }}">
              </div>
              <div class="card-message">"{{t.text}}"</div>
              <small class="card-details"><i class="fas fa-calendar"></i> Created: {{ t.date_created }}</small>
              <div class="card-actions">
                <button class="btn btn-primary" onclick="editTestimonial('{{t.id}}')">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" onclick="confirmDelete('testimonial', '{{t.id}}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
            {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
              <i class="fas fa-quote-left" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
              <p>No testimonials have been added yet.</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div id="messages-section" class="content-section">
        <div class="section">
          <div class="section-header">
            <h2><i class="fas fa-envelope" style="margin-right: 0.5rem; color: var(--primary-yellow);"></i>Customer
              Queries</h2>
          </div>
          <div class="grid-container" id="messagesList">
            {% for m in messages %}
            <div class="card" data-id="{{m.id}}">
              <div class="card-title">{{ m.name }}</div>
              <div style="margin-bottom: 1rem;">
                <span class="status-badge status-{{m.status.replace(' ','') if m.status else 'New'}}">{{m.status or
                  'New'}}</span>
              </div>
              <div class="card-details">
                <strong><i class="fas fa-cog"></i> Service:</strong> {{m.service or 'N/A'}}<br>
                <strong><i class="fas fa-envelope"></i> Email:</strong> {{m.email}}<br>
                <strong><i class="fas fa-phone"></i> Phone:</strong> {{m.phone}}
              </div>
              <div class="card-message">{{m.message}}</div>
              <small class="card-details"><i class="fas fa-clock"></i> Received: {{m.timestamp.split('T')[0] if
                m.timestamp else 'Unknown'}}</small>
              <div class="card-actions">
                <select onchange="updateMsgStatus('{{m.id}}', this.value)"
                  style="flex-grow:1; padding: 0.7rem; border-radius: 10px; border: 2px solid #e1e5e9; font-family: inherit;">
                  {% for st in ['New','In Progress','Answered','Finished'] %}
                  <option value="{{st}}" {% if m.status==st %}selected{% endif %}>{{st}}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-danger" onclick="confirmDelete('message', '{{m.id}}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
            {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666;">
              <i class="fas fa-envelope" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
              <p>No messages yet.</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </main>
  </div>

  <div class="modal-bg" id="projectModalBg">
    <div class="modal">
      <form id="projectForm" autocomplete="off">
        <input type="hidden" name="id" id="proj_id">
        <h2 id="projectModalTitle" class="modal-header">Add Project</h2>
        <label for="proj_title">Project Title</label>
        <input type="text" name="title" id="proj_title" required placeholder="Enter project title">
        <label for="proj_desc">Description</label>
        <textarea name="description" id="proj_desc" required rows="4"
          placeholder="Describe the project details"></textarea>
        <label for="proj_category">Category</label>
        <select name="category" id="proj_category" required>
          <option value="">Select Category</option>
          <option value="residential">Residential</option>
          <option value="commercial">Commercial</option>
          <option value="renovation">Renovation</option>
          <option value="architectural">Architectural</option>
        </select>
        <label for="proj_status">Status</label>
        <select name="status" id="proj_status" required>
          <option value="">Select Status</option>
          <option value="ongoing">Ongoing</option>
          <option value="completed">Completed</option>
          <option value="planned">Planned</option>
        </select>
        <label for="proj_image">Project Image (jpg/png, max 2MB)</label>
        <input type="file" accept="image/*" name="image" id="proj_image">
        <img class="image-preview" id="proj_imagePreview" src="#" alt="Image Preview" />
        <div class="modal-actions">
          <button type="button" class="btn" onclick="closeModal('projectModalBg')"
            style="background: #6c757d; color: white;">Cancel</button>
          <button type="submit" class="btn btn-primary" id="projSubmitBtn">Save Project</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-bg" id="testimonialModalBg">
    <div class="modal">
      <form id="testimonialForm" autocomplete="off">
        <input type="hidden" name="id" id="test_id">
        <h2 id="testimonialModalTitle" class="modal-header">Add Testimonial</h2>
        <label for="test_name">Author Name</label>
        <input type="text" name="name" id="test_name" required placeholder="Enter client name">
        <label for="test_company">Company / Location</label>
        <input type="text" name="company" id="test_company" required placeholder="Enter company or location">
        <label for="test_text">Testimonial Text</label>
        <textarea name="text" id="test_text" required rows="4" placeholder="Enter the client's testimonial"></textarea>
        <label for="test_rating">Rating</label>
        <select name="rating" id="test_rating" required>
          <option value="">Select Rating</option>
          <option value="5">5 Stars - Excellent</option>
          <option value="4">4 Stars - Very Good</option>
          <option value="3">3 Stars - Good</option>
          <option value="2">2 Stars - Fair</option>
          <option value="1">1 Star - Poor</option>
        </select>
        <label for="test_image">Author Image (jpg/png, max 2MB)</label>
        <input type="file" accept="image/*" name="image" id="test_image">
        <img class="image-preview" id="test_imagePreview" src="#" alt="Image Preview" />
        <div class="modal-actions">
          <button type="button" class="btn" onclick="closeModal('testimonialModalBg')"
            style="background: #6c757d; color: white;">Cancel</button>
          <button type="submit" class="btn btn-primary" id="testSubmitBtn">Save Testimonial</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-bg" id="confirmModal">
    <div class="modal">
      <h2 id="confirmTitle" class="modal-header">Confirm Action</h2>
      <p id="confirmMessage">Are you sure you want to proceed?</p>
      <div class="modal-actions">
        <button type="button" class="btn" id="confirmCancelBtn"
          style="background: #6c757d; color: white;">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmOkBtn">Confirm</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="{{ url_for('static', filename='js/admin_dashboard.js') }}"></script>
</body>

<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
    <div class="loading-text">RRR Construction</div>
    <div class="loading-subtext">Bringing your vision to life...</div>
  </div>

  <!-- Your existing navbar and content continues here... -->

</html>